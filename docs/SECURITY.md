# Документация по безопасности

## Обзор системы шифрования

В нашем проекте используется многоуровневая система защиты данных:

1. **TLS на уровне Reverse-Proxy** - Шифрование трафика между клиентом и сервером
2. **Серверное шифрование (SSE)** - Шифрование данных перед сохранением в базу данных

### Отказ от E2EE

Вместо сквозного шифрования (E2EE) применяется комбинация TLS и серверного шифрования, что облегчает разработку и поддержку.

## Серверное шифрование (SSE)

### Как работает

Сервер автоматически шифрует чувствительные данные перед сохранением в базу данных:

- Используется алгоритм AES-256-GCM
- Ключ шифрования хранится в переменной окружения `SSE_KEY_BASE64`
- Зашифрованные данные хранятся в колонке `content_encrypted` таблицы `messages`

### Управление ключами

Для генерации ключа шифрования предоставлены специальные скрипты:
- `generate-sse-key.sh` - для Linux/macOS
- `generate-sse-key.ps1` - для Windows

Эти скрипты:
- Генерируют криптостойкий ключ (256 бит)
- Сохраняют ключ в файл `.env`
- Предоставляют инструкции по его применению

### ВАЖНО: Безопасность ключа

⚠️ Потеря ключа шифрования приведет к **НЕВОЗМОЖНОСТИ** восстановления зашифрованных данных!

## TLS (на уровне Reverse-Proxy)

Весь TLS-трафик обрабатывается на уровне reverse-proxy:

- Сертификаты должны быть настроены на уровне proxy
- Внутренний трафик в Docker-сети не требует TLS

## Настройка для разработки

Для локальной разработки:

1. Выполните генерацию ключа:
   ```
   # Windows
   .\generate-sse-key.ps1
   
   # Linux/macOS
   ./generate-sse-key.sh
   ```

2. Запустите приложение с переменными окружения из `.env`:
   ```
   docker compose up -d
   ```

## Дополнительные меры безопасности

- Все пароли хранятся в виде хешей (bcrypt)
- JWT с ограниченным сроком действия
- Проверка CORS и защита от CSRF
- Загруженные файлы проверяются на тип и размер 